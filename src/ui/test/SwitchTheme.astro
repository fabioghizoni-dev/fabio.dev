---
import { Icon } from "astro-icon/components";
---

<button
  type="button"
  role="button"
  id="btn-theme"
  aria-label="Button to change theme"
  class="relative flex w-10 h-10 ml-auto justify-center items-center cursor-pointer rounded-full
    overflow-hidden"
>
  <!-- Mode Dark -->
  <Icon
    id="btn-moon"
    title="Dark mode"
    aria-label="Dark mode"
    class="absolute w-full h-full text-purple-blue rounded-full"
    name="line-md:sunny-filled-loop-to-moon-filled-loop-transition"
  />
  <!-- Mode Light -->
  <Icon
    id="btn-sun"
    title="Light mode"
    aria-label="Light mode"
    name="line-md:moon-filled-to-sunny-filled-loop-transition"
    class="absolute w-full h-full text-purple-blue hidden rounded-full"
  />
</button>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const btnSun = document.getElementById("btn-sun");
    const btnMoon = document.getElementById("btn-moon");
    const btnTheme = document.getElementById("btn-theme");
    if (btnSun && btnMoon && btnTheme) {
      const hide = (el) => {
        el.classList.add("animate-hide");
        el.addEventListener(
          "animationend",
          () => {
            el.classList.remove("animate-hide");
            el.classList.add("hidden");
          },
          { once: true }
        );
      };
      const show = (el) => {
        el.classList.remove("hidden");
        el.classList.add("animate-show");
        el.addEventListener(
          "animationend",
          () => {
            el.classList.remove("animate-show");
          },
          { once: true }
        );
      };
      let isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const toggle = () => {
        if (isDarkMode) {
          if ((btnSun.style.opacity = 0)) {
            hide(btnSun);
            show(btnMoon);
          }
        } else {
          show(btnSun);
          hide(btnMoon);
        }
      };
      btnTheme.addEventListener("click", toggle);
    }
  });
</script>
