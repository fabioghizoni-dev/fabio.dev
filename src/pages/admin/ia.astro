---
export const prerender = false;
import Layout from "../../layouts/Layout.astro";
import p from "../../constants/personal";
import { Icon } from "astro-icon/components";
---

<Layout title=`IA | ${p.name}` bodyClass="justify-center p-8">
  <h1 class="mb-4 text-2xl font-bold text-black dark:text-white">
    Eu sou Groot
  </h1>

  <div
    id="chat"
    class="bg-gray-default mb-4 h-[70dvh] w-full max-w-7xl overflow-y-auto rounded border p-2"
  >
  </div>

  <form id="form" class="flex w-full max-w-7xl items-center justify-center">
    <input
      id="input"
      class="flex-1 rounded-l bg-gray-700 p-2 text-white"
      placeholder="Digite sua mensagem"
    />
    <Icon name="akar-icons:attach" class="size-7.5 rotate-35 text-white" />
    <Icon name="mdi:microphone" class="size-8 text-white" />
    <button class="rounded-r bg-blue-600 p-2">Enviar</button>
  </form>

  <script is:inline>
    const chat = document.getElementById("chat");
    const form = document.getElementById("form");
    const input = document.getElementById("input");

    function addMessage(role, message) {
      const div = document.createElement("div");
      div.className = role === "user" ? "text-right my-1" : "text-left my-1";
      div.textContent = message;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const msg = input.value.trim();
      if (!msg) return;

      addMessage("user", msg);
      input.value = "";

      // Simulando IA grátis (resposta automática)
      const response = await fetch(`/api/chat?msg=${encodeURIComponent(msg)}`);
      const data = await response.json();
      addMessage("bot", data.reply);
    });
  </script>
</Layout>
