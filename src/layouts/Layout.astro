---
import Analytics from "@vercel/analytics/astro";
import SpeedInsights from "@vercel/speed-insights/astro";
import { ClientRouter } from "astro:transitions";
import CopyRight from "../components/CopyRight.astro";
import Header from "../components/Header.astro";
import "../styles/globals.css";
import Modal from "../ui/Modal.astro";
import cn, { removeSpaces } from "../utils";
import p from "../constants/personal";

interface Props {
  lang?: string;
  title?: string;
  author?: string;
  modal?: boolean;
  header?: boolean;
  footer?: boolean;
  siteUrl?: string;
  iconHref?: string;
  dataTheme?: string;
  generator?: string;
  bodyClass?: string;
  keywords?: string[];
  description?: string;
  clientRouter?: boolean;
}

let { description }: Props = Astro.props;

description = removeSpaces(
  description ??
    `Welcome to my portfolio website. Feel free to explore and learn more about the site and me. Here you'll find 
      my projects and information about my skills and experiences.`,
);

const {
  header,
  footer,
  lang = "en",
  modal = true,
  bodyClass = "",
  dataTheme = "dark",
  clientRouter = true,
  iconHref = "/logo.svg",
  author = p.name,
  generator = Astro.generator,
  title = `Portf√≥lio | ${p.name}`,
  siteUrl = p.siteUrl,
  keywords = [
    "Astro",
    "React",
    "Node.js",
    "Database",
    "Back-end",
    "Front-end",
    "Portfolio",
    "Developer",
    "TypeScript",
    "JavaScript",
    "UI/UX Design",
    "Tailwind CSS",
    "Web Developer",
    "F√°bio Ghizoni",
    "Paran√° Brazil",
    "Tech Portfolio",
    "Web Development",
    "API development",
    "Software Engineer",
    "Desenvolvedor Web",
    "Responsive Design",
    "Full-stack Developer",
    "Programador Full-stack",
    "Web Application Development",
  ],
}: Props = Astro.props;

const googleFontsUrl = (url: "googleapis" | "gstatic" = "googleapis") =>
  `https://fonts.${url}.com`;

const baseBodyClass = removeSpaces(
  `dark:selection:text-purple-blue selection:bg-purple-blue flex min-h-screen w-full flex-col items-center justify-between 
    bg-white/80 transition-colors duration-500 ease-in-out selection:text-white dark:bg-black dark:selection:bg-white`,
);
---

<!doctype html>
<html lang={lang} data-theme={dataTheme}>
  <head>
    {clientRouter && <ClientRouter />}

    <meta charset="UTF-8" />
    <meta name="language" content={lang} />
    <meta name="author" content={author} />
    <meta name="generator" content={generator} />
    <meta name="description" content={description} />
    <link rel="canonical" href={siteUrl} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content={dataTheme === "dark" ? "#000" : "#fff"} />
    <meta name="keywords" content={keywords.join(", ")} />

    <!-- Title -->
    <title>{title}</title>

    <!-- Icon -->
    <link rel="icon" type="image/svg+xml" href={iconHref} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:site_name" content={title} />
    <meta property="og:url" content={siteUrl} />
    <meta property="og:image" content={`${siteUrl}/logo_neon.svg`} />

    <!-- Twitter Card -->
    <meta name="twitter:title" content={title} />
    <meta name="twitter:creator" content={p.socials.x} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content={`${siteUrl}/logo_neon.svg`} />
    <meta name="twitter:description" content={description} />

    <!-- Google Fonts -->
    <link rel="preconnect" href={googleFontsUrl("googleapis")} />
    <link crossorigin rel="preconnect" href={googleFontsUrl("gstatic")} />
    <link
      rel="stylesheet"
      href={`${googleFontsUrl("googleapis")}/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap`}
    />
    <link
      rel="stylesheet"
      href={`${googleFontsUrl("googleapis")}/css2?family=Cascadia+Code:ital,wght@0,200..700;1,200..700&family=Noto+Sans+JP:wght@100..900&family=Space+Grotesk:wght@300..700&display=swap`}
    />
  </head>
  <body class={cn(baseBodyClass, bodyClass)}>
    <Analytics />
    <SpeedInsights />

    {header && <Header />}
    {modal && <Modal />}
    <slot />
    {footer && <CopyRight />}

    <script>
      import c from "clogs.ts";

      addEventListener("DOMContentLoaded", () => {
        try {
          const lang =
            localStorage.getItem("site:lang") || document.documentElement.lang;
          document.documentElement.lang = lang;
          c.log(`üåê Language initialized: ${lang}`);
        } catch (err) {
          c.warn("Error initializing language:", err);
        }
      });
    </script>
  </body>
</html>
